---
title: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
subtitle: "Asset Pricing Theory"
author: "Juan F. Imbet"
institute: "Paris Dauphine University-PSL"
format:
  revealjs:
    theme: white
    css: ../../../assets/styles.css
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
execute:
  enabled: false
---

------------------------------------------------------------------------

## Binary Trees

Consider the following economy. 

- Two periods, today and tomorrow, and two states of nature (up **u**, down **d**). 
- One risky asset (stock) and one riskless asset (bond).
- The price of the stock today is $S$; the bond price today is $1$.
- The risk-free bond pays $1+r_f$ tomorrow in every state.
- The stock pays $uS$ in state **u** and $dS$ in state **d**, with $u>d>0$.
- The (physical) probabilities are $\mathbb P(u)=\pi$ and $\mathbb P(d)=1-\pi$.

**No-Arbitrage (NA) feasibility region:** $d < 1+r_f < u$.

---

## No-Arbitrage Pricing by Replication

Let $X$ be any asset with payoffs $X_u$ (state **u**) and $X_d$ (state **d**).
- What is its price today, $p$?
- Replicate its payoffs with $b$ units of the bond and $\theta$ of the stock.

**Payoffs of the replicating portfolio:**
$$
\begin{aligned}
	\text{state }u: &\quad b(1+r_f) + \theta\,uS \\
	\text{state }d: &\quad b(1+r_f) + \theta\,dS
\end{aligned}
$$
Match payoffs:
$$
\begin{aligned}
b(1+r_f) + \theta\,uS &= X_u,\\
b(1+r_f) + \theta\,dS &= X_d.
\end{aligned}
$$

---

## Solving for the Replicating Weights

Subtract the two equations:
$$
	\theta (u-d)S = X_u - X_d
\quad\Longrightarrow\quad
\boxed{\;\theta = \dfrac{X_u - X_d}{(u-d)S}\;}
$$

Back-out the bond position (use, e.g., the **u** equation):
$$
\boxed{\;b
= \frac{X_u - \theta\,uS}{1+r_f}
= \frac{u X_d - d X_u}{(u-d)(1+r_f)}\;}
$$

**Price today** (cost of the replicating portfolio):
$$
\begin{aligned}
p &= b + \theta S \\
&= \frac{u X_d - d X_u}{(u-d)(1+r_f)} \;+\; \frac{X_u - X_d}{u-d} \\
&= \frac{(1+r_f - d) X_u + (u - (1+r_f)) X_d}{(u-d)(1+r_f)} \\
&= \frac{1}{1+r_f} \Big[ \frac{1+r_f -d}{u-d} X_u + \frac{u - (1+r_f)}{u-d} X_d \Big]\\
&= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
&= \frac{1}{1+r_f}\mathbb{E}^Q\Big[X\Big]
\end{aligned}
$$

---

## Arrow-Debreu Securities

- Price of an asset that pays 1 in state **u** and 0 in state **d**:
$$
  \begin{aligned}
  q_u = \frac{(1+r_f) - d}{(u - d)(1+r_f)} \\
  q_d = \frac{u - (1+r_f)}{(u - d)(1+r_f)}
  \end{aligned}
$$

Price of a bond is $(1+r_f)$ times the sum of the prices of the Arrow-Debreu securities:
$$
  (q_u + q_d)(1+r_f) = 1
$$

## The S.D.F.

- Start with the linear pricing formula:
$$
  p = \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big]
$$
- Multiply and divide by their respective probabilities ($\pi$ and $1-\pi$):
$$
\begin{aligned}
  p &= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
    &= \mathbb{E}\Big[\frac{1}{1+r_f}\Big(\frac{\tilde{q}}{\pi} X_u + \frac{1-\tilde{q}}{1-\pi} X_d\Big)\Big] = \mathbb{E}[M X]
\end{aligned}
$$


---

## Consumption Based Asset Pricing

- So far we have proved the existence and some conditions on $M$, but what does it capture?
- We will get some insights by understanding how investors make investment decisions to smooth consumption. 
- Consider an investor with initial wealth $W_0$ who invests in a risk-free bond and a risky stock.
- The investor has Von Neumann-Morgenstern preferences over consumption at $t=0$ and $t=1$:

## Von Neumann-Morgenstern preferences
- Preferences over lotteries are complete, transitive, continuous and independent (Axioms of choice). 
- These preferences can be represented by computing expectations of an utility function $u(x)$ on wealth (or consumption).
- The utility function is unique up to positive affine transformations.

## Setup
- The risky asset has price $p$ today and pays $X$ tomorrow.
- The risk free rate is $r_f$. 
- Today the investor chooses how many units $\theta$ of the risky asset to buy and how many units $b$ of the risk free bond to buy.


---

## Investor's problem

- The investor consumes today $C_0 = W_0 - p\theta - b$, and consumes tomorrow $C_1 = (1+r_f)b + \theta X$ which is a random variable. 
- The investor maximizes expected utility:
$$
\max_{\theta,b} u(C_0) + \beta \mathbb{E}[u(C_1)]
$$
subject to the budget constraint ($C_0$ and $C_1$ defined above).
- Replace the constraints in the objective function to make it unconstrained:
$$
\max_{\theta,b} u(W_0 - p\theta - b) + \beta \mathbb{E}[u((1+r_f)b + \theta X)]
$$
- The first order conditions are:
$$
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial b} &= -u'(C_0) + \beta (1+r_f) \mathbb{E}[u'(C_1)] = 0 \\
\frac{\partial \mathcal{L}}{\partial \theta} &= -p u'(C_0) + \beta \mathbb{E}[X u'(C_1)] = 0
\end{aligned}
$$
- Solve for $p$
$$
p =  \mathbb{E}[\beta \frac{u'(C_1)}{u'(C_0)} X]
$$


---

## Interpretation of the S.D.F.

- In this setup, the S.D.F. is the intertemporal marginal rate of substitution of consumption.
- The S.D.F. is high when consumption tomorrow is low (i.e., $u'(C_1)$ is high) relative to consumption today (i.e., $u'(C_0)$ is low).
- The S.D.F. is low when consumption tomorrow is high (i.e., $u'(C_1)$ is low) relative to consumption today (i.e., $u'(C_0)$ is high).
- Investors are willing to pay more for assets that pay off in bad times (when consumption is low) and less for assets that pay off in good times (when consumption is high).
- Partial Equilibrium view: Aggregate Consumption is given exogenously and investors optimize their portfolios given their consumption paths.
- General Equilibrium view: Asset prices and consumption are determined simultaneously. Investors choose their consumption and investment plans to maximize their utility subject to their budget constraints and the market clearing conditions.

---

## Some useful tools

- CARA (exponential utility) is very tractable with normal asset payoffs. 
- If $u(X) = -e^{-\gamma X}$ and $X \sim \mathcal{N}(\mu, \sigma^2)$, then
$$
\mathbb{E}[u(X)] = -\exp\left(-\gamma \mu + \frac{1}{2} \gamma^2 \sigma^2\right)
$$
- This identity can be proven using the moment generating function and the certain equivalent interpretation of CARA utility.

---

## Continuous-States (1-period) CARA–Normal 

### Setup
- Preferences (CARA): $u(C) = -e^{-\gamma C}$, $\gamma>0$.
- Today’s consumption: $C_0 = W_0 - p\,\theta - b$.
- Tomorrow’s consumption: $C_1 = (1+r_f)\,b + \theta X$, with $X \sim \mathcal N(\mu,\sigma^2)$.
- Objective:
$$
\max_{\theta,b}\; -e^{-\gamma (W_0 - p\theta - b)} \;+\; \beta\,\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right].
$$

Using normality of $X$ and CARA (certainty-equivalent for the second term):
$$
\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right]
= -\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

Define
$$
\Phi(b,\theta) \equiv -e^{-\gamma (W_0 - p\theta - b)}
\;-\;\beta\,\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

---

## First-order conditions

1) FOC in $b$:
$$
\frac{\partial \Phi}{\partial b}
= -\gamma e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,\gamma(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
=0.
$$
Hence
$$
 e^{-\gamma (W_0 - p\theta - b)}
= \beta(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}.
$$

2) FOC in $\theta$:
$$
\frac{\partial \Phi}{\partial \theta}
= -\gamma p\,e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)
=0.
$$

Use FOC-$b$ to eliminate the exponential terms:
$$
-\gamma p \cdot \big[\beta(1+r_f)\,e^{-\gamma(\cdots)}\big]
+ \beta\,e^{-\gamma(\cdots)}\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)=0,
$$
so (divide by $\beta e^{-\gamma(\cdots)}\gamma>0$):
$$
-\,p(1+r_f) + \mu - \gamma\theta\sigma^2 = 0.
$$

---

## Demand and Price

- **Optimal risky demand (given price $p$)**:
$$
\boxed{\;\theta^*(p) \;=\; \frac{\mu - (1+r_f)\,p}{\gamma\,\sigma^2}\; }.
$$

- **Equilibrium price with outside supply $\bar\theta$** (market clearing $\theta^*=\bar\theta$):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\bar\theta\,\sigma^2}{\,1+r_f\,}\; }.
$$

- **Partial-equilibrium “mean–variance” pricing identity** (from the FOC directly):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\theta^*\,\sigma^2}{\,1+r_f\,}\;}
\quad\Longleftrightarrow\quad
(1+r_f)\,p \;=\; \mu \;-\; \gamma\,\theta^*\,\sigma^2.
$$

> Interpretation: price equals discounted mean payoff minus a **risk discount**
> proportional to risk aversion $\gamma$, position size $\theta^*$, and variance $\sigma^2$.

---

## Log-Linearization as a Toolbox

We often need to connect expected returns with properties of the SDF.

- Fundamental pricing: $\;1 = \mathbb E[M R]\,$ for any gross return $R$.
- Covariance decomposition: $\;\mathbb E[M] \mathbb E[R] + \operatorname{Cov}(M,R) = 1\,$ so
  $$
  \boxed{\;\mathbb E[R] = R_f \;-\; \frac{\operatorname{Cov}(M,R)}{\mathbb E[M]}\;}\quad\text{with}\quad R_f = \frac{1}{\mathbb E[M]}.
  $$
  Risk premia are negative multiples of $\operatorname{Cov}(M,R)$.

---

### Lognormal/log-linear relations

Let $x=\log M$ and $r=\log R$. If $(x+r)$ is (approximately) normal, then
$$
1 = \mathbb E[M R] = \mathbb E\big[e^{x+r}\big] = \exp\Big(\mathbb E[x+r] + \tfrac12\operatorname{Var}(x+r)\Big),
$$
which implies
$$
\boxed{\;\mathbb E[r] = -\mathbb E[x] - \tfrac12\operatorname{Var}(x+r)\;}
\;=\; -\mathbb E[\log M] - \tfrac12\Big(\operatorname{Var}(\log M) + \operatorname{Var}(\log R) + 2\operatorname{Cov}(\log M,\log R)\Big).
$$

For the risk-free rate, using $1=\mathbb E[M R_f] = R_f\,\mathbb E[M]$ and (approximate) lognormal $M$:
$$
\boxed{\;\log R_f = -\log\mathbb E[M] \approx -\mathbb E[\log M] - \tfrac12\operatorname{Var}(\log M)\; }.
$$
Approximation detail: letting $y\equiv \log M$ and $K_y(t)\equiv \log\mathbb E[e^{t y}]$ be the cumulant generating function, a second-order truncation gives $K_y(1) \approx \mathbb E[y] + \tfrac12\operatorname{Var}(y)$ (exact if $y$ is normal). Hence $\log R_f = -K_y(1) \approx -\mathbb E[\log M] - \tfrac12\operatorname{Var}(\log M)$.

---

### Specialization to CRRA (power utility)

With one-period CRRA, $u(C)=\tfrac{C^{1-\gamma}}{1-\gamma}$,
$$
M = \beta\,\Big(\frac{C_1}{C_0}\Big)^{-\gamma} \quad\Rightarrow\quad \log M = \log\beta - \gamma\,\Delta c,
$$
where $\Delta c \equiv \log C_1 - \log C_0$. If $\Delta c$ is (approximately) normal with mean $\mu_c$ and variance $\sigma_c^2$, then
$$
\log R_f \approx -\log\beta + \gamma\,\mu_c - \tfrac12\gamma^2\sigma_c^2.
$$
Approximation detail: $\log M = \log\beta - \gamma\,\Delta c$. If $\Delta c\sim\mathcal N(\mu_c,\sigma_c^2)$ then $\log M$ is normal and the expression is exact; if not exactly normal, apply the second-order cumulant approximation in the previous bullet.
Risk premia follow from $\mathbb E[R]-R_f \approx -\dfrac{\operatorname{Cov}(M,R)}{\mathbb E[M]}$ or, in logs,
$$
\mathbb E[r] \approx \log R_f \; -\; \operatorname{Cov}(\log M,\log R) \; -\; \tfrac12\operatorname{Var}(\log R).
$$
Approximation detail: from $1=\mathbb E[e^{x+r}]$ with $x\equiv\log M$, use $\log\mathbb E[e^{x+r}]\approx \mathbb E[x+r] + \tfrac12\operatorname{Var}(x+r)$ (exact if $x+r$ is normal). Setting this to zero and solving for $\mathbb E[r]$ yields the expression above.

::: {.financial-concept}
Why this is useful: log-linearization converts nonlinear pricing conditions into linear relations among means, variances and covariances that are easy to interpret and calibrate.
:::

---

### The risk-free rate puzzle (Weil, 1989)

- Matching the equity premium with CRRA often requires high $\gamma$, but then the model predicts too high $\log R_f$ via $-\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2$.
- Conversely, matching the low observed $R_f$ calls for low $\gamma$ (or implausibly high $\beta$), then the equity premium becomes too small.
- This tension motivates enriched preferences or endowment risk, e.g., habit formation or disaster risk.

---

## Simple Growth-Based Habit (one-period)

We adopt a tractable specification where utility depends on current consumption and recent growth:
$$
u_t \;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma}\,\Big(\frac{C_{t-1}}{C_t}\Big)^{\kappa}
\;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma-\kappa}\,C_{t-1}^{\,\kappa},\qquad \gamma>0,\;\kappa\ge 0.
$$
This penalizes low consumption relative to last period (a simple habit flavor) yet keeps closed-form expressions.

---

### SDF and pricing equation

Marginal utility: $\;u_C(C_t) = C_t^{-\gamma-\kappa}\,C_{t-1}^{\kappa}$. The one-period SDF is
$$
\boxed{\; M = \beta\,\frac{u_C(C_1)}{u_C(C_0)}
\;=\; \beta\,\Big(\frac{C_1}{C_0}\Big)^{-(\gamma+\kappa)} \times \underbrace{\Big(\frac{C_0}{C_{-1}}\Big)^{\kappa}}_{\text{known at }t=0}\;,\quad 1=\mathbb E[MR].\;}
$$
The known term can be absorbed in normalization, so the random part is
$$
\log M = \log\beta - (\gamma+\kappa)\,\Delta c,\qquad \Delta c \equiv \log C_1 - \log C_0.
$$

---

### Log-linearization and the risk-free rate

If $\Delta c \sim \mathcal N(\mu_c,\sigma_c^2)$ (or is approximately normal):
$$
\boxed{\;\log R_f \approx -\log\beta + (\gamma+\kappa)\,\mu_c - \tfrac12(\gamma+\kappa)^2\,\sigma_c^2\; }.
$$
Approximation detail: the log-SDF is $\log M = \log\beta - (\gamma+\kappa)\,\Delta c$, normal under the stated assumption (exact). Otherwise use the second-order cumulant approximation for $-\log\mathbb E[M]$.
Risk premia (levels or logs) follow the usual covariance rules with $\log M$; habit simply shifts the effective sensitivity from $\gamma$ to $\gamma+\kappa$.

---

### Why this helps

- With $\kappa>0$, the SDF is more cyclical (responds more to $\Delta c$): larger premia for a given $\gamma$.
- The extra parameter $\kappa$ lets us jointly fit a low $R_f$ and sizable premia without resorting to extreme $\gamma$.
- Still keeps the same clean log-linear formulas.

---

## Rare Disasters: A Simple Model

We add low-probability, high-severity consumption drops to study their impact on policy and prices.

### Setup

- CRRA agent with SDF $M = \beta (C_1/C_0)^{-\gamma}$.
- Consumption growth with rare disasters (Barro-style):
  $$
  \Delta c = \mu_c + \sigma_c\,\varepsilon - J D,\quad \varepsilon\sim\mathcal N(0,1),\; D\sim\text{Bernoulli}(p),\; J>0,\; p\ll 1.
  $$
  With probability $p$, a disaster reduces consumption by a fraction $1-e^{-J}$.

---

### Assumptions and timing

- One-period, representative agent, CRRA preferences: $u(C)=\tfrac{C^{1-\gamma}}{1-\gamma}$, $\gamma>0$.
- Endowment economy: aggregate consumption equals the endowment; investors trade Arrow-Debreu or assets with payoffs at $t=1$.
- Information/timing: at $t=0$ choose portfolios, at $t=1$ shocks $(\varepsilon, D)$ realize and payoffs are delivered.
- SDF from marginal rate of substitution:
  $$\boxed{\;M \;=\; \beta\,\Big(\tfrac{C_1}{C_0}\Big)^{-\gamma}\;}.$$

---

### Optimization and Euler equations

- Representative agent chooses $(b,\{\theta_i\})$ to maximize $u(C_0)+\beta\,\mathbb E[u(C_1)]$ subject to budget constraints.
- First-order conditions deliver, for each asset $i$ with gross return $R_i$:
  $$\boxed{\;1 = \mathbb E\big[M\,R_i\big] \;},\qquad \boxed{\;R_f^{-1} = \mathbb E[M]\;}.$$
- With CRRA and the disaster process above, all pricing results boil down to computing $\mathbb E[\exp(\cdot)]$ under a Normal–Bernoulli mixture.

---

### Risk-free rate with disaster risk

Using $R_f = 1/\mathbb E[M]$ and independence of $\varepsilon$ and $D$:
$$
\begin{aligned}
\mathbb E[M]
&= \beta\,\mathbb E\big[e^{-\gamma\Delta c}\big] \\
&= \beta\,\mathbb E\big[\exp\{-\gamma(\mu_c+\sigma_c\varepsilon - JD)\}\big] \\
&= \beta\,e^{-\gamma\mu_c}\,\underbrace{\mathbb E\big[e^{-\gamma\sigma_c\varepsilon}\big]}_{\exp(\tfrac12\gamma^2\sigma_c^2)}\;\underbrace{\mathbb E\big[e^{\gamma J D}\big]}_{(1-p)+p e^{\gamma J}} \\
&= \beta\,e^{-\gamma\mu_c + \tfrac12\gamma^2\sigma_c^2}\,\big[(1-p) + p\,e^{\gamma J}\big],
\end{aligned}
$$
so
$$
\boxed{\;\log R_f = -\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2 \; -\; \log\big[(1-p) + p\,e^{\gamma J}\big].\;}
$$
The last (negative) term lowers $R_f$, helping resolve the risk‑free rate puzzle.

---

### Pricing assets with disaster exposure

- Consider an asset with log return $r \equiv \log R$ that loads linearly on consumption growth:
  $$\boxed{\; r = a + k\,\Delta c + \eta,\;\; \eta\perp (\varepsilon,D),\; \eta\sim\mathcal N(0, s^2).\;}$$
  The parameter $k$ captures exposure to consumption risk and to disasters through $\Delta c$.
- Pricing condition in logs uses the Normal–Bernoulli mixture:
  $$
  1 = \mathbb E[e^{\log M + r}]
  = e^{\log\beta + a + (k-\gamma)\mu_c}\,\underbrace{\mathbb E\big[e^{(k-\gamma)\sigma_c\varepsilon + \eta}\big]}_{\exp(\tfrac12[(k-\gamma)^2\sigma_c^2 + s^2])}\;\underbrace{\mathbb E\big[e^{-(k-\gamma)J D}\big]}_{(1-p)+p\,e^{-(k-\gamma)J}}.
  $$
  Taking logs of both sides (RHS is positive) and rearranging to isolate $a$:
  $$
  \begin{aligned}
  0
  &= \log\beta + a + (k-\gamma)\mu_c + \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
    + \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big] \\
  \Longrightarrow\quad
  a
  &= -\log\beta -(k-\gamma)\mu_c - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
    - \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big].
  \end{aligned}
  $$
  Hence the pricing-implied intercept is
  $$
  \boxed{\; a
  = -\log\beta -(k-\gamma)\mu_c - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
    - \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big].\;}
  $$
  Why this is needed: $a$ is not free once exposure $k$ and the distributional parameters are fixed. The Euler equation $1=\mathbb E[MR]$ pins the unconditional level of returns so the asset is correctly priced by the SDF; otherwise we would violate no-arbitrage.
- Expected log return and comparison to $\log R_f$ then follow directly.

---

### Lognormal–jump approximation: how it works

- Key building block: for $D\sim\text{Bernoulli}(p)$, $\;\mathbb E[e^{t(-J D)}] = (1-p) + p\,e^{-tJ}$.
- Cumulant (log-MGF) decomposition for $x\equiv\log M$ and $r\equiv\log R$:
  $$
  \log \mathbb E[e^{x+r}] = \underbrace{\mathbb E[x+r]}_{\text{mean}} + \tfrac12\underbrace{\operatorname{Var}(x+r)}_{\text{Gaussian part}} \; +\; \underbrace{\log\big[(1-p)+p\,e^{\Delta_t}\big]}_{\text{jump correction}},
  $$
  where $\Delta_t$ is the coefficient on $D$ inside $(x+r)$ evaluated at $t=1$; here $\Delta_1 = -(k-\gamma)J$.
- Small-$p$ or small-$J$ expansion:
  $$
  \log\big[(1-p)+p\,e^{\Delta}\big]
  = \log\big(1 + p\,(e^{\Delta}-1)\big)
\approx p\,(e^{\Delta}-1)\;\;\text{(FO in $p$)} \\
e^{\Delta} \approx 1 + \Delta + \tfrac12\Delta^2\;\;\text{(SO in $\Delta$ near 0)} \\
\Rightarrow\; \log\big[(1-p)+p\,e^{\Delta}\big] \approx p\,(\Delta + \tfrac12\Delta^2)\;\;\text{(neglecting $\mathcal O(p^2)$ terms)}.
  $$
  This yields “lognormal + jump correction” formulas that are accurate when disasters are rare and/or modest in size.

---

### Toy linear exposure: step-by-step derivations

With $r=a+k\Delta c+\eta$ and $x=\log M=\log\beta-\gamma\Delta c$:

1) Moments under the Normal–Bernoulli mixture (purely statistical):
- $\mathbb E[r] = a + k\mu_c - k p J + \tfrac12 k^2\sigma_c^2 + \tfrac12 s^2$.
- $\operatorname{Cov}(x,r) = -\gamma k\,\sigma_c^2 + \gamma k\,p\,J$.

2) Pricing via $1=\mathbb E[e^{x+r}]$ pins down $a$ (see box above). Subtracting $\log R_f$ gives an approximate expected excess log return:
$$
\mathbb E[r] - \log R_f
\;\approx\; -\operatorname{Cov}(x,r) \; - \tfrac12\operatorname{Var}(r)
\; +\; \underbrace{p\Big(e^{-(k-\gamma)J}-e^{\gamma J}\Big)}_{\text{jump premium adj.}}\;\text{(small)}.
$$
Approximation detail: expand the jump terms using $\log[(1-p)+p e^{\alpha}] \approx p\alpha$ for small $p$ (FO in $p$) and, if needed, $e^{\alpha}\approx 1+\alpha+\tfrac12\alpha^2$ (SO in $\alpha$). Higher-order $\mathcal O(p^2)$ terms are dropped.
Keeping leading terms delivers the intuition: larger $p$ or $J$ increases the disaster-state covariance in magnitude, raising risk premia.

3) Special case: an equity claim with $k>0$ (procyclical). Then disasters both lower $\log R_f$ and increase required premia, moving the model toward the data.

---

### Notes on accuracy and limits

- Approximations rely on (i) Gaussian core for $\Delta c$, (ii) independence across normal and jump parts, and (iii) rare/modest disasters when using Taylor expansions.
- For larger $p$ or $J$, prefer exact mixture formulas (those with the explicit $\log[(1-p)+p e^{\cdot}]$ terms) rather than Taylor series.
- Exposure $k$ can be generalized (multiple factors, leverage); the same mixture logic applies asset-by-asset.

---

## Campbell–Cochrane Habit: Setup and SDF

- Preferences feature external habit $X_t$ and surplus consumption ratio $S_t \equiv \dfrac{C_t - X_t}{C_t} \in (0,1)$.
- Utility is time-separable CRRA over surplus consumption: $u(C_t, X_t) = \dfrac{(C_t - X_t)^{1-\gamma}}{1-\gamma} = \dfrac{\big(S_t C_t\big)^{1-\gamma}}{1-\gamma}$, with $\gamma>0$.
- Intertemporal marginal rate of substitution (one-period SDF):
  $$M_{t+1} = \beta\,\left(\frac{S_{t+1} C_{t+1}}{S_t C_t}\right)^{-\gamma} = \beta\,\left(\frac{C_{t+1}}{C_t}\right)^{-\gamma}\,\left(\frac{S_{t+1}}{S_t}\right)^{-\gamma}.$$
- Log form: $\log M_{t+1} = \log\beta - \gamma\,\Delta c_{t+1} - \gamma\,\Delta s_{t+1}$ with $\Delta c_{t+1} \equiv \log(C_{t+1}/C_t)$ and $\Delta s_{t+1} \equiv \log(S_{t+1}/S_t)$.
- Key idea: choose $S_t$ dynamics so that risk premia vary strongly with the business cycle while keeping a smooth risk-free rate.

---

## Habit Dynamics and Surplus Ratio Law of Motion

- Let consumption growth be i.i.d. lognormal: $\Delta c_{t+1} = g + \sigma_c \varepsilon_{t+1}$, $\varepsilon\sim \mathcal N(0,1)$.
- Surplus ratio follows: $\log S_{t+1} - \log S_t = \phi\,(\bar s - \log S_t) + \lambda\,\sigma_c\,\varepsilon_{t+1}$ (mean reversion plus sensitivity), with $\phi\in(0,1)$.
- In levels, an equivalent approximation: $S_{t+1} = S_t^{1-\phi}\,e^{\phi \bar s}\,\exp\{\lambda\,\sigma_c\,\varepsilon_{t+1}\}$.
- State dependence: when $S_t$ is low (habit close to consumption), marginal utility is very sensitive; risk premia rise in recessions.
- Calibration pins $\lambda$ to damp the risk-free rate volatility: set $\lambda$ to offset the consumption term in $\log R_{f,t}$ (see next slide).

---

## Risk-Free Rate Derivation and Smoothness Condition

- Definition: $R_{f,t}^{-1} = \mathbb E_t[M_{t+1}]$.
- Use lognormality conditional on $S_t$: write $x_{t+1} \equiv \log M_{t+1} = \log\beta - \gamma\,\Delta c_{t+1} - \gamma\,\Delta s_{t+1}$.
- With $\Delta c_{t+1} = g + \sigma_c\varepsilon_{t+1}$ and $\Delta s_{t+1} = \phi(\bar s - \log S_t) + \lambda\sigma_c\varepsilon_{t+1}$:
  $$x_{t+1} = \log\beta - \gamma\,g - \gamma\,\phi(\bar s - \log S_t) - \gamma(1+\lambda)\sigma_c\,\varepsilon_{t+1}.$$
- Then $\mathbb E_t[M_{t+1}] = \exp\big(\mathbb E_t[x_{t+1}] + \tfrac12\operatorname{Var}_t(x_{t+1})\big)$ gives
  $$\log R_{f,t} = -\log\beta + \gamma g + \gamma\,\phi(\bar s - \log S_t) - \tfrac12\gamma^2(1+\lambda)^2\sigma_c^2.$$
 - Smooth $R_f$: choose $\lambda$ so $\gamma\,\phi(\bar s - \log S_t)$ variation is minimized; in CC (1999) $\lambda$ is set to cancel shocks so $R_{f,t}$ is nearly constant.
 - Approximation detail: conditional lognormality gives $\log R_{f,t} = -\log\mathbb E_t[M_{t+1}] \approx -\mathbb E_t[\log M_{t+1}] - \tfrac12\operatorname{Var}_t(\log M_{t+1})$; with $\log M_{t+1}$ affine in $\varepsilon_{t+1}$, this is exact.

---

## Risk Premia and Time-Varying Price of Risk

- Pricing condition: $1 = \mathbb E_t[M_{t+1} R_{i,t+1}]$ and in logs $\mathbb E_t[r_{i,t+1}] \approx \log R_{f,t} - \operatorname{Cov}_t(\log M_{t+1}, r_{i,t+1}) - \tfrac12\operatorname{Var}_t(r_{i,t+1})$.
- Let asset $i$ have log return $r_{i,t+1} = \mu_i + b_i\,\sigma_c\,\varepsilon_{t+1} + \eta_{i,t+1}$ with $\eta$ idiosyncratic and independent.
- Instantaneous market price of risk (per unit shock): $\Lambda_t \equiv -\operatorname{Cov}_t(\log M_{t+1}, \varepsilon_{t+1}) = \gamma(1+\lambda)\sigma_c$.
- State dependence enters through $S_t$ if $\lambda$ is itself a function of $S_t$; in CC, $\lambda(S_t)$ rises as $S_t$ falls, making $\Lambda_t$ countercyclical.
- Expected excess log return: $\mathbb E_t[r_{i,t+1}] - \log R_{f,t} \approx b_i\,\Lambda_t\,\sigma_c - \tfrac12\operatorname{Var}_t(r_{i,t+1})$, increasing when $S_t$ is low.
 - Approximation detail: from $\log\mathbb E_t[e^{\log M_{t+1}+r_{i,t+1}}]=0$, use the second-order expansion and the linear shock representation for both terms; higher-order covariances are neglected.

---

## Implementing the CC Calibration Logic

- Choose $(\gamma, \sigma_c, g)$ from consumption data; select $\beta$ to match average $R_f$.
- Pick target average surplus $\bar S$ (or $\bar s=\log \bar S$) so that unconditional $S_t$ stays comfortably in $(0,1)$.
- Set mean reversion $\phi$ to target realistic persistence in the surplus ratio and hence in expected returns.
- Determine $\lambda(S_t)$ to stabilize $\log R_{f,t}$: e.g., make $(1+\lambda(S_t))$ decline when $S_t$ falls, offsetting shocks in $\Delta c$.
- Verify implications: countercyclical Sharpe ratios, high unconditional equity premium, low and smooth $R_f$, and realistic consumption–asset correlations.

