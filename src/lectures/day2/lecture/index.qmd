---
title: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
subtitle: "Asset Pricing Theory"
author: "Juan F. Imbet"
institute: "Paris Dauphine University-PSL"
format:
  revealjs:
    theme: white
    css: ../../../assets/styles.css
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
execute:
  enabled: false
---

------------------------------------------------------------------------

## Binary Trees

Consider the following economy. 

- Two periods, today and tomorrow, and two states of nature (up **u**, down **d**). 
- One risky asset (stock) and one riskless asset (bond).
- The price of the stock today is $S$; the bond price today is $1$.
- The risk-free bond pays $1+r_f$ tomorrow in every state.
- The stock pays $uS$ in state **u** and $dS$ in state **d**, with $u>d>0$.
- The (physical) probabilities are $\mathbb P(u)=\pi$ and $\mathbb P(d)=1-\pi$.

**No-Arbitrage (NA) feasibility region:** $d < 1+r_f < u$.

---

## No-Arbitrage Pricing by Replication

Let $X$ be any asset with payoffs $X_u$ (state **u**) and $X_d$ (state **d**).
- What is its price today, $p$?
- Replicate its payoffs with $b$ units of the bond and $\theta$ of the stock.

**Payoffs of the replicating portfolio:**
$$
\begin{aligned}
	\text{state }u: &\quad b(1+r_f) + \theta\,uS \\
	\text{state }d: &\quad b(1+r_f) + \theta\,dS
\end{aligned}
$$
Match payoffs:
$$
\begin{aligned}
b(1+r_f) + \theta\,uS &= X_u,\\
b(1+r_f) + \theta\,dS &= X_d.
\end{aligned}
$$

---

## Solving for the Replicating Weights

Subtract the two equations:
$$
	\theta (u-d)S = X_u - X_d
\quad\Longrightarrow\quad
\boxed{\;\theta = \dfrac{X_u - X_d}{(u-d)S}\;}
$$

Back-out the bond position (use, e.g., the **u** equation):
$$
\boxed{\;b
= \frac{X_u - \theta\,uS}{1+r_f}
= \frac{u X_d - d X_u}{(u-d)(1+r_f)}\;}
$$

**Price today** (cost of the replicating portfolio):
$$
\begin{aligned}
p &= b + \theta S \\
&= \frac{u X_d - d X_u}{(u-d)(1+r_f)} \;+\; \frac{X_u - X_d}{u-d} \\
&= \frac{(1+r_f - d) X_u + (u - (1+r_f)) X_d}{(u-d)(1+r_f)} \\
&= \frac{1}{1+r_f} \Big[ \frac{1+r_f -d}{u-d} X_u + \frac{u - (1+r_f)}{u-d} X_d \Big]\\
&= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
&= \frac{1}{1+r_f}\mathbb{E}^Q\Big[X\Big]
\end{aligned}
$$

---

## Arrow-Debreu Securities

- Price of an asset that pays 1 in state **u** and 0 in state **d**:
$$
  \begin{aligned}
  q_u = \frac{(1+r_f) - d}{(u - d)(1+r_f)} \\
  q_d = \frac{u - (1+r_f)}{(u - d)(1+r_f)}
  \end{aligned}
$$

Price of a bond is $(1+r_f)$ times the sum of the prices of the Arrow-Debreu securities:
$$
  (q_u + q_d)(1+r_f) = 1
$$

## The S.D.F.

- Start with the linear pricing formula:
$$
  p = \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big]
$$
- Multiply and divide by their respective probabilities ($\pi$ and $1-\pi$):
$$
\begin{aligned}
  p &= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
    &= \mathbb{E}\Big[\frac{1}{1+r_f}\Big(\frac{\tilde{q}}{\pi} X_u + \frac{1-\tilde{q}}{1-\pi} X_d\Big)\Big] = \mathbb{E}[M X]
\end{aligned}
$$


---

## Consumption Based Asset Pricing

- So far we have proved the existence and some conditions on $M$, but what does it capture?
- We will get some insights by understanding how investors make investment decisions to smooth consumption. 
- Consider an investor with initial wealth $W_0$ who invests in a risk-free bond and a risky stock.
- The investor has Von Neumann-Morgenstern preferences over consumption at $t=0$ and $t=1$:

## Von Neumann-Morgenstern preferences
- Preferences over lotteries are complete, transitive, continuous and independent (Axioms of choice). 
- These preferences can be represented by computing expectations of an utility function $u(x)$ on wealth (or consumption).
- The utility function is unique up to positive affine transformations.

## Setup
- The risky asset has price $p$ today and pays $X$ tomorrow.
- The risk free rate is $r_f$. 
- Today the investor chooses how many units $\theta$ of the risky asset to buy and how many units $b$ of the risk free bond to buy.


---

## Investor's problem

- The investor consumes today $C_0 = W_0 - p\theta - b$, and consumes tomorrow $C_1 = (1+r_f)b + \theta X$ which is a random variable. 
- The investor maximizes expected utility:
$$
\max_{\theta,b} u(C_0) + \beta \mathbb{E}[u(C_1)]
$$
subject to the budget constraint ($C_0$ and $C_1$ defined above).
- Replace the constraints in the objective function to make it unconstrained:
$$
\max_{\theta,b} u(W_0 - p\theta - b) + \beta \mathbb{E}[u((1+r_f)b + \theta X)]
$$
- The first order conditions are:
$$
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial b} &= -u'(C_0) + \beta (1+r_f) \mathbb{E}[u'(C_1)] = 0 \\
\frac{\partial \mathcal{L}}{\partial \theta} &= -p u'(C_0) + \beta \mathbb{E}[X u'(C_1)] = 0
\end{aligned}
$$
- Solve for $p$
$$
p =  \mathbb{E}[\beta \frac{u'(C_1)}{u'(C_0)} X]
$$


---

## Interpretation of the S.D.F.

- In this setup, the S.D.F. is the intertemporal marginal rate of substitution of consumption.
- The S.D.F. is high when consumption tomorrow is low (i.e., $u'(C_1)$ is high) relative to consumption today (i.e., $u'(C_0)$ is low).
- The S.D.F. is low when consumption tomorrow is high (i.e., $u'(C_1)$ is low) relative to consumption today (i.e., $u'(C_0)$ is high).
- Investors are willing to pay more for assets that pay off in bad times (when consumption is low) and less for assets that pay off in good times (when consumption is high).
- Partial Equilibrium view: Aggregate Consumption is given exogenously and investors optimize their portfolios given their consumption paths.
- General Equilibrium view: Asset prices and consumption are determined simultaneously. Investors choose their consumption and investment plans to maximize their utility subject to their budget constraints and the market clearing conditions.

---

## Some useful tools

- CARA (exponential utility) is very tractable with normal asset payoffs. 
- If $u(X) = -e^{-\gamma X}$ and $X \sim \mathcal{N}(\mu, \sigma^2)$, then
$$
\mathbb{E}[u(X)] = -\exp\left(-\gamma \mu + \frac{1}{2} \gamma^2 \sigma^2\right)
$$
- This identity can be proven using the moment generating function and the certain equivalent interpretation of CARA utility.

---

## Continuous-States (1-period) CARA–Normal 

### Setup
- Preferences (CARA): $u(C) = -e^{-\gamma C}$, $\gamma>0$.
- Today’s consumption: $C_0 = W_0 - p\,\theta - b$.
- Tomorrow’s consumption: $C_1 = (1+r_f)\,b + \theta X$, with $X \sim \mathcal N(\mu,\sigma^2)$.
- Objective:
$$
\max_{\theta,b}\; -e^{-\gamma (W_0 - p\theta - b)} \;+\; \beta\,\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right].
$$

Using normality of $X$ and CARA (certainty-equivalent for the second term):
$$
\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right]
= -\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

Define
$$
\Phi(b,\theta) \equiv -e^{-\gamma (W_0 - p\theta - b)}
\;-\;\beta\,\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

---

## First-order conditions

1) FOC in $b$:
$$
\frac{\partial \Phi}{\partial b}
= -\gamma e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,\gamma(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
=0.
$$
Hence
$$
 e^{-\gamma (W_0 - p\theta - b)}
= \beta(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}.
$$

2) FOC in $\theta$:
$$
\frac{\partial \Phi}{\partial \theta}
= -\gamma p\,e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)
=0.
$$

Use FOC-$b$ to eliminate the exponential terms:
$$
-\gamma p \cdot \big[\beta(1+r_f)\,e^{-\gamma(\cdots)}\big]
+ \beta\,e^{-\gamma(\cdots)}\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)=0,
$$
so (divide by $\beta e^{-\gamma(\cdots)}\gamma>0$):
$$
-\,p(1+r_f) + \mu - \gamma\theta\sigma^2 = 0.
$$

---

## Demand and Price

- **Optimal risky demand (given price $p$)**:
$$
\boxed{\;\theta^*(p) \;=\; \frac{\mu - (1+r_f)\,p}{\gamma\,\sigma^2}\; }.
$$

- **Equilibrium price with outside supply $\bar\theta$** (market clearing $\theta^*=\bar\theta$):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\bar\theta\,\sigma^2}{\,1+r_f\,}\; }.
$$

- **Partial-equilibrium “mean–variance” pricing identity** (from the FOC directly):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\theta^*\,\sigma^2}{\,1+r_f\,}\;}
\quad\Longleftrightarrow\quad
(1+r_f)\,p \;=\; \mu \;-\; \gamma\,\theta^*\,\sigma^2.
$$

> Interpretation: price equals discounted mean payoff minus a **risk discount**
> proportional to risk aversion $\gamma$, position size $\theta^*$, and variance $\sigma^2$.

---

## Log-Linearization as a Toolbox

We often need to connect expected returns with properties of the SDF.

- Fundamental pricing: $\;1 = \mathbb E[M R]\,$ for any gross return $R$.
- Covariance decomposition: $\;\mathbb E[M] \mathbb E[R] + \operatorname{Cov}(M,R) = 1\,$ so
  $$
  \boxed{\;\mathbb E[R] = R_f \;-\; \frac{\operatorname{Cov}(M,R)}{\mathbb E[M]}\;}\quad\text{with}\quad R_f = \frac{1}{\mathbb E[M]}.
  $$
  Risk premia are negative multiples of $\operatorname{Cov}(M,R)$.

---

### Lognormal/log-linear relations

Let $x=\log M$ and $r=\log R$. If $(x+r)$ is (approximately) normal, then
$$
1 = \mathbb E[M R] = \mathbb E\big[e^{x+r}\big] = \exp\Big(\mathbb E[x+r] + \tfrac12\operatorname{Var}(x+r)\Big),
$$
which implies
$$
\boxed{\;\mathbb E[r] = -\mathbb E[x] - \tfrac12\operatorname{Var}(x+r)\;}
\;=\; -\mathbb E[\log M] - \tfrac12\Big(\operatorname{Var}(\log M) + \operatorname{Var}(\log R) + 2\operatorname{Cov}(\log M,\log R)\Big).
$$

For the risk-free rate, using $1=\mathbb E[M R_f] = R_f\,\mathbb E[M]$ and (approximate) lognormal $M$:
$$
\boxed{\;\log R_f = -\log\mathbb E[M] \approx -\mathbb E[\log M] - \tfrac12\operatorname{Var}(\log M)\; }.
$$
Approximation detail: letting $y\equiv \log M$ and $K_y(t)\equiv \log\mathbb E[e^{t y}]$ be the cumulant generating function, a second-order truncation gives $K_y(1) \approx \mathbb E[y] + \tfrac12\operatorname{Var}(y)$ (exact if $y$ is normal). Hence $\log R_f = -K_y(1) \approx -\mathbb E[\log M] - \tfrac12\operatorname{Var}(\log M)$.

---

### Specialization to CRRA (power utility)

With one-period CRRA, $u(C)=\tfrac{C^{1-\gamma}}{1-\gamma}$,
$$
M = \beta\,\Big(\frac{C_1}{C_0}\Big)^{-\gamma} \quad\Rightarrow\quad \log M = \log\beta - \gamma\,\Delta c,
$$
where $\Delta c \equiv \log C_1 - \log C_0$. If $\Delta c$ is (approximately) normal with mean $\mu_c$ and variance $\sigma_c^2$, then
$$
\log R_f \approx -\log\beta + \gamma\,\mu_c - \tfrac12\gamma^2\sigma_c^2.
$$
Approximation detail: $\log M = \log\beta - \gamma\,\Delta c$. If $\Delta c\sim\mathcal N(\mu_c,\sigma_c^2)$ then $\log M$ is normal and the expression is exact; if not exactly normal, apply the second-order cumulant approximation in the previous bullet.
Risk premia follow from $\mathbb E[R]-R_f \approx -\dfrac{\operatorname{Cov}(M,R)}{\mathbb E[M]}$ or, in logs,
$$
\mathbb E[r] \approx \log R_f \; -\; \operatorname{Cov}(\log M,\log R) \; -\; \tfrac12\operatorname{Var}(\log R).
$$
Approximation detail: from $1=\mathbb E[e^{x+r}]$ with $x\equiv\log M$, use $\log\mathbb E[e^{x+r}]\approx \mathbb E[x+r] + \tfrac12\operatorname{Var}(x+r)$ (exact if $x+r$ is normal). Setting this to zero and solving for $\mathbb E[r]$ yields the expression above.

::: {.financial-concept}
Why this is useful: log-linearization converts nonlinear pricing conditions into linear relations among means, variances and covariances that are easy to interpret and calibrate.
:::

---

### The risk-free rate puzzle (Weil, 1989)

- Matching the equity premium with CRRA often requires high $\gamma$, but then the model predicts too high $\log R_f$ via $-\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2$.
- Conversely, matching the low observed $R_f$ calls for low $\gamma$ (or implausibly high $\beta$), then the equity premium becomes too small.
- This tension motivates enriched preferences or endowment risk, e.g., habit formation or disaster risk.

---

## Simple Growth-Based Habit (one-period)

We adopt a tractable specification where utility depends on current consumption and recent growth:
$$
u_t \;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma}\,\Big(\frac{C_{t-1}}{C_t}\Big)^{\kappa}
\;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma-\kappa}\,C_{t-1}^{\,\kappa},\qquad \gamma>0,\;\kappa\ge 0.
$$
This penalizes low consumption relative to last period (a simple habit flavor) yet keeps closed-form expressions.

---

### SDF and pricing equation

Marginal utility: $\;u_C(C_t) = C_t^{-\gamma-\kappa}\,C_{t-1}^{\kappa}$. The one-period SDF is
$$
\boxed{\; M = \beta\,\frac{u_C(C_1)}{u_C(C_0)}
\;=\; \beta\,\Big(\frac{C_1}{C_0}\Big)^{-(\gamma+\kappa)} \times \underbrace{\Big(\frac{C_0}{C_{-1}}\Big)^{\kappa}}_{\text{known at }t=0}\;,\quad 1=\mathbb E[MR].\;}
$$
The known term can be absorbed in normalization, so the random part is
$$
\log M = \log\beta - (\gamma+\kappa)\,\Delta c,\qquad \Delta c \equiv \log C_1 - \log C_0.
$$

---

### Log-linearization and the risk-free rate

If $\Delta c \sim \mathcal N(\mu_c,\sigma_c^2)$ (or is approximately normal):
$$
\boxed{\;\log R_f \approx -\log\beta + (\gamma+\kappa)\,\mu_c - \tfrac12(\gamma+\kappa)^2\,\sigma_c^2\; }.
$$
Approximation detail: the log-SDF is $\log M = \log\beta - (\gamma+\kappa)\,\Delta c$, normal under the stated assumption (exact). Otherwise use the second-order cumulant approximation for $-\log\mathbb E[M]$.
Risk premia (levels or logs) follow the usual covariance rules with $\log M$; habit simply shifts the effective sensitivity from $\gamma$ to $\gamma+\kappa$.

---

### Why this helps

- With $\kappa>0$, the SDF is more cyclical (responds more to $\Delta c$): larger premia for a given $\gamma$.
- The extra parameter $\kappa$ lets us jointly fit a low $R_f$ and sizable premia without resorting to extreme $\gamma$.
- Still keeps the same clean log-linear formulas.

---

## Rare Disasters: A Simple Model based on Barro (2006)

- Rietz (1988) — “The Equity Risk Premium: A Solution.”
Journal of Monetary Economics
- Robert J. Barro (2006) — “Rare Disasters and Asset Markets in the Twentieth Century.”
The Quarterly Journal of Economics,

We add low-probability, high-severity consumption drops to study their impact on policy and prices.

### Setup

- CRRA agent with SDF $M = \beta (C_1/C_0)^{-\gamma}$.
- Consumption growth with rare disasters (Barro-style):
  $$
  \Delta c = \mu_c + \sigma_c\,\varepsilon - J D,\quad \varepsilon\sim\mathcal N(0,1),\; D\sim\text{Bernoulli}(p),\; J>0,\; p\ll 1.
  $$
  With probability $p$, a disaster reduces consumption growth by $J$ and overall consumption by
  by a fraction $1-e^{-J}$.

- Rare disasters can be thought as any large negative shock to consumption that is rare
  - Famines
  - Wars
  - Pandemics
  - Financial crises
  - Natural disasters


---

### Assumptions and timing

- One-period, representative agent, CRRA preferences: $u(C)=\tfrac{C^{1-\gamma}}{1-\gamma}$, $\gamma>0$.
- Endowment economy: aggregate consumption equals the endowment; investors trade Arrow-Debreu or assets with payoffs at $t=1$.
- Information/timing: at $t=0$ choose portfolios, at $t=1$ shocks $(\varepsilon, D)$ realize and payoffs are delivered.
- SDF from marginal rate of substitution:
  $$\boxed{\;M \;=\; \beta\,\Big(\tfrac{C_1}{C_0}\Big)^{-\gamma}\;}.$$
- The exponential properties of the CRRA utility allows us to separate the normal and jump parts of $\Delta c$ in a tractable way.

---

### Optimization and Euler equations

- Since the SDF depends on aggregate consumption, and consumption growth is exogenous we don't need to setup a maximization program. We just need to understand the risk free and risky asset dynamics. 

$$
\begin{align}
\mathbb{E}[M] &= \mathbb{E}[\beta \Big( \frac{C_1}{C_0} \Big)^{-\gamma}] \\
&= \mathbb{E}[\beta e^{-\gamma \Delta c}] \\
&= \beta \mathbb{E}[e^{-\gamma(\mu_c + \sigma_c \varepsilon - J D)}] \\
&= \beta e^{-\gamma \mu_c} \mathbb{E}[e^{-\gamma \sigma_c \varepsilon}] \mathbb{E}[e^{\gamma J D}] \text{  Independence}\\
&= \beta e^{-\gamma \mu_c + \frac{1}{2} \gamma^2 \sigma_c^2} \big[(1-p) + p e^{\gamma J}\big]
\end{align}
$$
If $R_f = 1/\mathbb{E}[M]$ then we can compute the risk free rate in logs as 
$$
\log R_f = r_f = -\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2 - \log\big[(1-p) + p\,e^{\gamma J}\big].
$$

A reasonable $p$ and large consumption drop $J$ can generate a lower risk free rate.

---

### Pricing assets with disaster exposure

- To study risk premia we need to model how returns and consumption growth are related.
- Consider an asset with log return $r \equiv \log R$ that loads linearly on consumption growth:
  $$\boxed{\; r = a + k\,\Delta c + \eta,\;\; \eta\perp (\varepsilon,D),\; \eta\sim\mathcal N(0, s^2).\;}$$
  The parameter $k$ captures exposure to consumption risk and to disasters through $\Delta c$.
- Pricing condition in logs uses the Normal–Bernoulli mixture:
  $$
  \begin{align*}
1 &= \mathbb{E}[M R] = \mathbb{E}\!\big[e^{\log M + \log R}\big] 
      = \mathbb{E}\!\big[e^{m + r}\big] \\[4pt]
  & \text{with } m = \log M = \log\beta - \gamma \Delta c,\quad
      r = a + k \Delta c + \eta \\[4pt]
m + r &= (\log\beta - \gamma \Delta c) + (a + k \Delta c + \eta)
      = \log\beta + a + (k-\gamma)\Delta c + \eta \\[4pt]
\Delta c &= \mu_c + \sigma_c \varepsilon - J D \\[4pt]
\Rightarrow\quad
m + r &= \log\beta + a + (k-\gamma)(\mu_c + \sigma_c \varepsilon - J D) + \eta \\[4pt]
  &= \underbrace{\log\beta + a + (k-\gamma)\mu_c}_{\text{constant}}
     \;+\; (k-\gamma)\sigma_c \varepsilon
     \;-\; (k-\gamma)J D
     \;+\; \eta \\[6pt]
\end{align*}

---

### Pricing assets with disaster exposure (cont'd)

$$
\begin{align*}
\text{Independence } &(\varepsilon, D, \eta) \ \Longrightarrow \ 
\mathbb{E}\!\big[e^{m+r}\big]
   = e^{\log\beta + a + (k-\gamma)\mu_c}
     \;\mathbb{E}\!\big[e^{(k-\gamma)\sigma_c \varepsilon + \eta}\big]
     \;\mathbb{E}\!\big[e^{-(k-\gamma)J D}\big] \\[6pt]
\text{Normal part: } & (k-\gamma)\sigma_c \varepsilon + \eta 
   \sim \mathcal N\!\Big(0,\ (k-\gamma)^2\sigma_c^2 + s^2\Big) \\[4pt]
\Rightarrow\quad
\mathbb{E}\!\big[e^{(k-\gamma)\sigma_c \varepsilon + \eta}\big]
  &= \exp\!\Big(\tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]\Big) \\[6pt]
\text{Bernoulli part: }&
\mathbb{E}\!\big[e^{-(k-\gamma)J D}\big]
  = (1-p)\,e^{0} + p\,e^{-(k-\gamma)J}
  = (1-p)+p e^{-(k-\gamma)J} \\[6pt]
\therefore\quad
1 &= e^{\log\beta + a + (k-\gamma)\mu_c}
      \exp\!\Big(\tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]\Big)
      \big[(1-p)+p e^{-(k-\gamma)J}\big] \\[8pt]
0 &= \log\beta + a + (k-\gamma)\mu_c
      + \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
      + \log\big[(1-p)+p e^{-(k-\gamma)J}\big] \\[8pt]
\Longrightarrow\quad
a &= -\log\beta
     -(k-\gamma)\mu_c
     - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
     - \log\big[(1-p)+p e^{-(k-\gamma)J}\big].
\end{align*}
$$
Taking logs of both sides (RHS is positive) and rearranging to isolate $a$:
$$
\begin{aligned}
0
&= \log\beta + a + (k-\gamma)\mu_c + \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
  + \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big] \\
\Longrightarrow\quad
a
&= -\log\beta -(k-\gamma)\mu_c - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
  - \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big].
\end{aligned}
$$
Hence the pricing-implied intercept is
$$
\boxed{\; a
= -\log\beta -(k-\gamma)\mu_c - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big]
  - \log\big[(1-p)+p\,e^{-(k-\gamma)J}\big].\;}
$$


---

## Risk Premium under Rare Disasters

We now subtract the (log) risk‑free rate $r_f = \log R_f$ from the expected (log) return to expose parameter effects on the risk premium.

### Expected log return
With $r = a + k\Delta c + \eta$, $\Delta c = \mu_c + \sigma_c\varepsilon - J D$, $\eta\sim\mathcal N(0,s^2)$ and $\mathbb E[\Delta c]=\mu_c - pJ$:
$$
\begin{align*}
\mathbb E[r]
&= a + k(\mu_c - pJ) + \tfrac12 k^2\sigma_c^2 + \tfrac12 s^2 \\
&= -\log\beta -(k-\gamma)\mu_c - \tfrac12\big[(k-\gamma)^2\sigma_c^2 + s^2\big] - \log\big[(1-p)+p e^{-(k-\gamma)J}\big] \\
&\qquad + k(\mu_c - pJ) + \tfrac12 k^2\sigma_c^2 + \tfrac12 s^2 \\
&= -\log\beta + \gamma\mu_c + k\gamma\sigma_c^2 - k p J - \log\big[(1-p)+p e^{-(k-\gamma)J}\big].
\end{align*}
$$

### Log risk‑free rate
Previously derived:
$$
r_f = -\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2 - \log\big[(1-p)+p e^{\gamma J}\big].
$$

### Exact log risk premium
Subtracting yields
$$
\boxed{\;\mathbb E[r]-r_f = k\gamma\sigma_c^2 - k p J + \log\frac{(1-p)+p e^{\gamma J}}{(1-p)+p e^{-(k-\gamma)J}}\; }.
$$

---

## Rare / small-disaster approximation
If $p$ is small, $\log[(1-p)+p e^{\alpha}] \approx p(e^{\alpha}-1)$ so
$$
\mathbb E[r]-r_f \approx k\gamma\sigma_c^2 - k p J + p\big(e^{\gamma J} - e^{-(k-\gamma)J}\big).
$$

Approximation detail (why $\log[(1-p)+p e^{\alpha}] \approx p(e^{\alpha}-1)$):

$$
\log\big[(1-p)+p e^{\alpha}\big]
= \log\big(1 - p + p e^{\alpha}\big)
= \log\Big(1 + p(e^{\alpha}-1)\Big).
$$
Let $x \equiv p(e^{\alpha}-1)$. For fixed $\alpha$, small $p$ implies $|x|$ small. Use the Taylor series $\log(1+x) = x - \tfrac12 x^2 + \tfrac13 x^3 - \cdots$ to obtain the first-order (in $p$) approximation:
$$
\log\big[(1-p)+p e^{\alpha}\big] \approx p(e^{\alpha}-1), \qquad \text{error } = \mathcal O\!\big(p^2 (e^{\alpha}-1)^2\big).
$$
If additionally $\alpha$ is small, $e^{\alpha}-1 \approx \alpha + \tfrac12\alpha^2$, yielding
$$
\log\big[(1-p)+p e^{\alpha}\big] \approx p\alpha + \tfrac12 p\alpha^2.
$$
Retaining only the linear term in $p$ (and optionally the leading terms in $\alpha$) delivers the expression used above.

---

### Parameter sensitivities 
- Diffusive term $k\gamma\sigma_c^2$: higher exposure $k$, risk aversion $\gamma$, or volatility $\sigma_c$ raise premia.
- Disaster drag $-k p J$: procyclical assets ($k>0$) lose more in disasters, requiring higher compensation.
- Jump convexity $\log\frac{(1-p)+p e^{\gamma J}}{(1-p)+p e^{-(k-\gamma)J}}$: amplifies premia when $(p,J)$ or the mismatch $(k-\gamma)$ grow.
- Calibration leverage: $(p,J)$ allow matching large premia without implausibly large $\gamma$; small $p$ with sizable $J$ can materially boost premia.
- Cross-section: varying $k$ maps differential disaster and diffusion exposure into heterogeneous premia; hedging assets (low/negative $k$) earn low premia.

---

## Risk Premia under Habit

### Campbell–Cochrane Habit: Setup and SDF

- Campbell and Cochrane (1999) — “By Force of Habit: A Consumption-Based Explanation of Aggregate Stock Market Behavior.”
Journal of Political Economy
- Preferences feature external habit $X_t$ and surplus consumption ratio $S_t \equiv \dfrac{C_t - X_t}{C_t} \in (0,1)$.
- Utility is time-separable CRRA over surplus consumption: $u(C_t, X_t) = \dfrac{(C_t - X_t)^{1-\gamma}}{1-\gamma} = \dfrac{\big(S_t C_t\big)^{1-\gamma}}{1-\gamma}$, with $\gamma>0$.
- Intertemporal marginal rate of substitution (one-period SDF):
  $$M_{t+1} = \beta\,\left(\frac{S_{t+1} C_{t+1}}{S_t C_t}\right)^{-\gamma} = \beta\,\left(\frac{C_{t+1}}{C_t}\right)^{-\gamma}\,\left(\frac{S_{t+1}}{S_t}\right)^{-\gamma}.$$
- Log form: $\log M_{t+1} = \log\beta - \gamma\,\Delta c_{t+1} - \gamma\,\Delta s_{t+1}$ with $\Delta c_{t+1} \equiv \log(C_{t+1}/C_t)$ and $\Delta s_{t+1} \equiv \log(S_{t+1}/S_t)$.
- Key idea: choose $S_t$ dynamics so that risk premia vary strongly with the business cycle while keeping a smooth risk-free rate.

---

## Habit Dynamics and Surplus Ratio Law of Motion

- Let consumption growth be i.i.d. normal: $\Delta c_{t+1} = g + \sigma_c \varepsilon_{t+1}$, $\varepsilon\sim \mathcal N(0,1)$.
- Surplus ratio follows: $\log S_{t+1} - \log S_t = \Delta s_{t+1} = \phi\,(\bar s - s_t) + \lambda\,\sigma_c\,\varepsilon_{t+1}$ (mean reversion plus sensitivity), with $\phi\in(0,1)$.
- In levels, an equivalent approximation: $S_{t+1} = S_t^{1-\phi}\,e^{\phi \bar s + \lambda \sigma_c \varepsilon_{t+1}}$.
- State dependence: when $S_t$ is low (habit close to consumption), marginal utility is very sensitive; risk premia rise in recessions.
- Calibration pins $\lambda$ to damp the risk-free rate volatility: set $\lambda$ to offset the consumption term in $\log R_{f,t}$ (see next slide).

---

## Risk-Free Rate Derivation and Smoothness Condition

- Definition: $R_{f,t}^{-1} = \mathbb E_t[M_{t+1}]$.
- Use lognormality conditional on $S_t$: write $x_{t+1} \equiv \log M_{t+1} = \log\beta - \gamma\,\Delta c_{t+1} - \gamma\,\Delta s_{t+1}$.
- With $\Delta c_{t+1} = g + \sigma_c\varepsilon_{t+1}$ and $\Delta s_{t+1} = \phi(\bar s - \log S_t) + \lambda\sigma_c\varepsilon_{t+1}$:
  $$x_{t+1} = \log\beta - \gamma\,g - \gamma\,\phi(\bar s - s_t) - \gamma(1+\lambda)\sigma_c\,\varepsilon_{t+1}.$$
- Then $\mathbb E_t[M_{t+1}] = \exp\big(\mathbb E_t[x_{t+1}] + \tfrac12\operatorname{Var}_t(x_{t+1})\big)$ gives
  $$\log R_{f,t} = -\log\beta + \gamma g + \gamma\,\phi(\bar s - s_t) - \tfrac12\gamma^2(1+\lambda)^2\sigma_c^2.$$
 - Smooth $R_f$: choose $\lambda$ so $\gamma\,\phi(\bar s - s_t)$ variation is minimized; in CC (1999) $\lambda$ is set to cancel shocks so $R_{f,t}$ is nearly constant.

---

## Risk Premia and Time-Varying Price of Risk (General Case)

- Derivation (log form): start from $1 = \mathbb E_t[M_{t+1} R_{i,t+1}]$. Write $m_{t+1}=\log M_{t+1}$ and $r_{i,t+1}=\log R_{i,t+1}$. Then
  $$0 = \log \mathbb E_t\big[e^{m_{t+1}+r_{i,t+1}}\big].$$
  Apply a second-order (lognormal) approximation (exact if $m_{t+1}+r_{i,t+1}$ is conditionally normal):
  $$0 \approx \mathbb E_t[m_{t+1}+r_{i,t+1}] + \tfrac12\operatorname{Var}_t(m_{t+1}+r_{i,t+1}).$$
  Rearranging for the conditional expected log return gives
  $$\mathbb E_t[r_{i,t+1}] \approx -\mathbb E_t[m_{t+1}] - \tfrac12\operatorname{Var}_t(m_{t+1}) - \tfrac12\operatorname{Var}_t(r_{i,t+1}) - \operatorname{Cov}_t(m_{t+1}, r_{i,t+1}).$$
  Using $\log R_{f,t} = -\log \mathbb E_t[M_{t+1}] \approx -\mathbb E_t[m_{t+1}] - \tfrac12\operatorname{Var}_t(m_{t+1})$ we substitute and obtain the slide’s relation.
- Pricing condition: $1 = \mathbb E_t[M_{t+1} R_{i,t+1}]$ and in logs $\mathbb E_t[r_{i,t+1}] \approx \log R_{f,t} - \operatorname{Cov}_t(\log M_{t+1}, r_{i,t+1}) - \tfrac12\operatorname{Var}_t(r_{i,t+1})$.
- Let asset $i$ have log return $r_{i,t+1} = \mu_i + b_i\,\sigma_c\,\varepsilon_{t+1} + \eta_{i,t+1}$ with $\eta$ idiosyncratic and independent.
- Instantaneous market price of risk (per unit shock): $\Lambda_t \equiv -\operatorname{Cov}_t(\log M_{t+1}, \varepsilon_{t+1}) = \gamma(1+\lambda)\sigma_c$.
- Expected excess log return: with $\operatorname{Var}_t(r_{i,t+1}) = b_i^2\sigma_c^2 + s_i^2$ (define $s_i^2\equiv\operatorname{Var}(\eta_{i,t+1})$),
  $$\mathbb E_t[r_{i,t+1}] - \log R_{f,t} \approx b_i\,\Lambda_t\,\sigma_c - \tfrac12\big(b_i^2\sigma_c^2 + s_i^2\big).$$
  Equivalently,
  $$\mathbb E_t[r_{i,t+1}] \approx \log R_{f,t} + b_i\gamma(1+\lambda)\sigma_c^2 - \tfrac12 b_i^2\sigma_c^2 - \tfrac12 s_i^2.$$ 

---

## Implementing the CC Calibration Logic

- Choose $(\gamma, \sigma_c, g)$ from consumption data; select $\beta$ to match average $R_f$.
- Pick target average surplus $\bar S$ (or $\bar s=\log \bar S$) so that unconditional $S_t$ stays comfortably in $(0,1)$.
- Set mean reversion $\phi$ to target realistic persistence in the surplus ratio and hence in expected returns.
- Determine $\lambda(S_t)$ to stabilize $\log R_{f,t}$: e.g., make $(1+\lambda(S_t))$ decline when $S_t$ falls, offsetting shocks in $\Delta c$.
- Verify implications: countercyclical Sharpe ratios, high unconditional equity premium, low and smooth $R_f$, and realistic consumption–asset correlations.

