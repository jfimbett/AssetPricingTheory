---
title: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
subtitle: "Asset Pricing Theory"
author: "Juan F. Imbet"
institute: "Paris Dauphine University-PSL"
format:
  revealjs:
    theme: white
    css: ../../../assets/styles.css
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: "Asset Pricing Theory - Binary Trees and Consumption Based Asset Pricing"
execute:
  enabled: false
---

------------------------------------------------------------------------

## Binary Trees

Consider the following economy. 

- Two periods, today and tomorrow, and two states of nature (up **u**, down **d**). 
- One risky asset (stock) and one riskless asset (bond).
- The price of the stock today is $S$; the bond price today is $1$.
- The risk-free bond pays $1+r_f$ tomorrow in every state.
- The stock pays $uS$ in state **u** and $dS$ in state **d**, with $u>d>0$.
- The (physical) probabilities are $\mathbb P(u)=\pi$ and $\mathbb P(d)=1-\pi$.

**No-Arbitrage (NA) feasibility region:** $d < 1+r_f < u$.

---

## No-Arbitrage Pricing by Replication

Let $X$ be any asset with payoffs $X_u$ (state **u**) and $X_d$ (state **d**).
- What is its price today, $p$?
- Replicate its payoffs with $b$ units of the bond and $\theta$ of the stock.

**Payoffs of the replicating portfolio:**
$$
\begin{aligned}
	\text{state }u: &\quad b(1+r_f) + \theta\,uS \\
	\text{state }d: &\quad b(1+r_f) + \theta\,dS
\end{aligned}
$$
Match payoffs:
$$
\begin{aligned}
b(1+r_f) + \theta\,uS &= X_u,\\
b(1+r_f) + \theta\,dS &= X_d.
\end{aligned}
$$

---

## Solving for the Replicating Weights

Subtract the two equations:
$$
	\theta (u-d)S = X_u - X_d
\quad\Longrightarrow\quad
\boxed{\;\theta = \dfrac{X_u - X_d}{(u-d)S}\;}
$$

Back-out the bond position (use, e.g., the **u** equation):
$$
\boxed{\;b
= \frac{X_u - \theta\,uS}{1+r_f}
= \frac{u X_d - d X_u}{(u-d)(1+r_f)}\;}
$$

**Price today** (cost of the replicating portfolio):
$$
\begin{aligned}
p &= b + \theta S \\
&= \frac{u X_d - d X_u}{(u-d)(1+r_f)} \;+\; \frac{X_u - X_d}{u-d} \\
&= \frac{(1+r_f - d) X_u + (u - (1+r_f)) X_d}{(u-d)(1+r_f)} \\
&= \frac{1}{1+r_f} \Big[ \frac{1+r_f -d}{u-d} X_u + \frac{u - (1+r_f)}{u-d} X_d \Big]\\
&= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
&= \frac{1}{1+r_f}\mathbb{E}^Q\Big[X\Big]
\end{aligned}
$$

---

## Arrow-Debreu Securities

- Price of an asset that pays 1 in state **u** and 0 in state **d**:
$$
  \begin{aligned}
  q_u = \frac{(1+r_f) - d}{(u - d)(1+r_f)} \\
  q_d = \frac{u - (1+r_f)}{(u - d)(1+r_f)}
  \end{aligned}
$$

Price of a bond is $(1+r_f)$ times the sum of the prices of the Arrow-Debreu securities:
$$
  (q_u + q_d)(1+r_f) = 1
$$

## The S.D.F.

- Start with the linear pricing formula:
$$
  p = \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big]
$$
- Multiply and divide by their respective probabilities ($\pi$ and $1-\pi$):
$$
\begin{aligned}
  p &= \frac{1}{1+r_f} \big[ \tilde{q} X_u + (1-\tilde{q}) X_d \big] \\
    &= \mathbb{E}\Big[\frac{1}{1+r_f}\Big(\frac{\tilde{q}}{\pi} X_u + \frac{1-\tilde{q}}{1-\pi} X_d\Big)\Big] = \mathbb{E}[M X]
\end{aligned}
$$


---

## Consumption Based Asset Pricing

- So far we have proved the existence and some conditions on $M$, but what does it capture?
- We will get some insights by understanding how investors make investment decisions to smooth consumption. 
- Consider an investor with initial wealth $W_0$ who invests in a risk-free bond and a risky stock.
- The investor has Von Neumann-Morgenstern preferences over consumption at $t=0$ and $t=1$:

## Von Neumann-Morgenstern preferences
- Preferences over lotteries are complete, transitive, continuous and independent (Axioms of choice). 
- These preferences can be represented by computing expectations of an utility function $u(x)$ on wealth (or consumption).
- The utility function is unique up to positive affine transformations.

## Setup
- The risky asset has price $p$ today and pays $X$ tomorrow.
- The risk free rate is $r_f$. 
- Today the investor chooses how many units $\theta$ of the risky asset to buy and how many units $b$ of the risk free bond to buy.


---

## Investor's problem

- The investor consumes today $C_0 = W_0 - p\theta - b$, and consumes tomorrow $C_1 = (1+r_f)b + \theta X$ which is a random variable. 
- The investor maximizes expected utility:
$$
\max_{\theta,b} u(C_0) + \beta \mathbb{E}[u(C_1)]
$$
subject to the budget constraint ($C_0$ and $C_1$ defined above).
- Replace the constraints in the objective function to make it unconstrained:
$$
\max_{\theta,b} u(W_0 - p\theta - b) + \beta \mathbb{E}[u((1+r_f)b + \theta X)]
$$
- The first order conditions are:
$$
\begin{aligned}
\frac{\partial \mathcal{L}}{\partial b} &= -u'(C_0) + \beta (1+r_f) \mathbb{E}[u'(C_1)] = 0 \\
\frac{\partial \mathcal{L}}{\partial \theta} &= -p u'(C_0) + \beta \mathbb{E}[X u'(C_1)] = 0
\end{aligned}
$$
- Solve for $p$
$$
p =  \mathbb{E}[\beta \frac{u'(C_1)}{u'(C_0)} X]
$$


---

## Interpretation of the S.D.F.

- In this setup, the S.D.F. is the intertemporal marginal rate of substitution of consumption.
- The S.D.F. is high when consumption tomorrow is low (i.e., $u'(C_1)$ is high) relative to consumption today (i.e., $u'(C_0)$ is low).
- The S.D.F. is low when consumption tomorrow is high (i.e., $u'(C_1)$ is low) relative to consumption today (i.e., $u'(C_0)$ is high).
- Investors are willing to pay more for assets that pay off in bad times (when consumption is low) and less for assets that pay off in good times (when consumption is high).
- Partial Equilibrium view: Aggregate Consumption is given exogenously and investors optimize their portfolios given their consumption paths.
- General Equilibrium view: Asset prices and consumption are determined simultaneously. Investors choose their consumption and investment plans to maximize their utility subject to their budget constraints and the market clearing conditions.

---

## Some useful tools

- CARA (exponential utility) is very tractable with normal asset payoffs. 
- If $u(X) = -e^{-\gamma X}$ and $X \sim \mathcal{N}(\mu, \sigma^2)$, then
$$
\mathbb{E}[u(X)] = -\exp\left(-\gamma \mu + \frac{1}{2} \gamma^2 \sigma^2\right)
$$
- This identity can be proven using the moment generating function and the certain equivalent interpretation of CARA utility.

---

## Continuous-States (1-period) CARA–Normal 

### Setup
- Preferences (CARA): $u(C) = -e^{-\gamma C}$, $\gamma>0$.
- Today’s consumption: $C_0 = W_0 - p\,\theta - b$.
- Tomorrow’s consumption: $C_1 = (1+r_f)\,b + \theta X$, with $X \sim \mathcal N(\mu,\sigma^2)$.
- Objective:
$$
\max_{\theta,b}\; -e^{-\gamma (W_0 - p\theta - b)} \;+\; \beta\,\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right].
$$

Using normality of $X$ and CARA (certainty-equivalent for the second term):
$$
\mathbb E\!\left[-e^{-\gamma\big((1+r_f)b+\theta X\big)}\right]
= -\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

Define
$$
\Phi(b,\theta) \equiv -e^{-\gamma (W_0 - p\theta - b)}
\;-\;\beta\,\exp\!\left(-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2\right).
$$

---

## First-order conditions

1) FOC in $b$:
$$
\frac{\partial \Phi}{\partial b}
= -\gamma e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,\gamma(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
=0.
$$
Hence
$$
 e^{-\gamma (W_0 - p\theta - b)}
= \beta(1+r_f)\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}.
$$

2) FOC in $\theta$:
$$
\frac{\partial \Phi}{\partial \theta}
= -\gamma p\,e^{-\gamma (W_0 - p\theta - b)}
\;+\;\beta\,e^{-\gamma\big((1+r_f)b+\theta\mu\big) + \tfrac12 \gamma^2 \theta^2\sigma^2}
\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)
=0.
$$

Use FOC-$b$ to eliminate the exponential terms:
$$
-\gamma p \cdot \big[\beta(1+r_f)\,e^{-\gamma(\cdots)}\big]
+ \beta\,e^{-\gamma(\cdots)}\big(\gamma\mu - \gamma^2 \theta \sigma^2\big)=0,
$$
so (divide by $\beta e^{-\gamma(\cdots)}\gamma>0$):
$$
-\,p(1+r_f) + \mu - \gamma\theta\sigma^2 = 0.
$$

---

## Demand and Price

- **Optimal risky demand (given price $p$)**:
$$
\boxed{\;\theta^*(p) \;=\; \frac{\mu - (1+r_f)\,p}{\gamma\,\sigma^2}\; }.
$$

- **Equilibrium price with outside supply $\bar\theta$** (market clearing $\theta^*=\bar\theta$):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\bar\theta\,\sigma^2}{\,1+r_f\,}\; }.
$$

- **Partial-equilibrium “mean–variance” pricing identity** (from the FOC directly):
$$
\boxed{\;p \;=\; \frac{\mu - \gamma\,\theta^*\,\sigma^2}{\,1+r_f\,}\;}
\quad\Longleftrightarrow\quad
(1+r_f)\,p \;=\; \mu \;-\; \gamma\,\theta^*\,\sigma^2.
$$

> Interpretation: price equals discounted mean payoff minus a **risk discount**
> proportional to risk aversion $\gamma$, position size $\theta^*$, and variance $\sigma^2$.

---

## Log-Linearization as a Toolbox

We often need to connect expected returns with properties of the SDF.

- Fundamental pricing: $\;1 = \mathbb E[M R]\,$ for any gross return $R$.
- Covariance decomposition: $\;\mathbb E[M] \mathbb E[R] + \operatorname{Cov}(M,R) = 1\,$ so
  $$
  \boxed{\;\mathbb E[R] = R_f \;-\; \frac{\operatorname{Cov}(M,R)}{\mathbb E[M]}\;}\quad\text{with}\quad R_f = \frac{1}{\mathbb E[M]}.
  $$
  Risk premia are negative multiples of $\operatorname{Cov}(M,R)$.

---

### Lognormal/log-linear relations

Let $x=\log M$ and $r=\log R$. If $(x+r)$ is (approximately) normal, then
$$
1 = \mathbb E[M R] = \mathbb E\big[e^{x+r}\big] = \exp\Big(\mathbb E[x+r] + \tfrac12\operatorname{Var}(x+r)\Big),
$$
which implies
$$
\boxed{\;\mathbb E[r] = -\mathbb E[x] - \tfrac12\operatorname{Var}(x+r)\;}
\;=\; -\mathbb E[\log M] - \tfrac12\Big(\operatorname{Var}(\log M) + \operatorname{Var}(\log R) + 2\operatorname{Cov}(\log M,\log R)\Big).
$$

For the risk-free rate, using $1=\mathbb E[M R_f] = R_f\,\mathbb E[M]$ and (approximate) lognormal $M$:
$$
\boxed{\;\log R_f = -\log\mathbb E[M] \approx -\mathbb E[\log M] - \tfrac12\operatorname{Var}(\log M)\; }.
$$

---

### Specialization to CRRA (power utility)

With one-period CRRA, $u(C)=\tfrac{C^{1-\gamma}}{1-\gamma}$,
$$
M = \beta\,\Big(\frac{C_1}{C_0}\Big)^{-\gamma} \quad\Rightarrow\quad \log M = \log\beta - \gamma\,\Delta c,
$$
where $\Delta c \equiv \log C_1 - \log C_0$. If $\Delta c$ is (approximately) normal with mean $\mu_c$ and variance $\sigma_c^2$, then
$$
\log R_f \approx -\log\beta + \gamma\,\mu_c - \tfrac12\gamma^2\sigma_c^2.
$$
Risk premia follow from $\mathbb E[R]-R_f \approx -\dfrac{\operatorname{Cov}(M,R)}{\mathbb E[M]}$ or, in logs,
$$
\mathbb E[r] \approx \log R_f \; -\; \operatorname{Cov}(\log M,\log R) \; -\; \tfrac12\operatorname{Var}(\log R).
$$

::: {.financial-concept}
Why this is useful: log-linearization converts nonlinear pricing conditions into linear relations among means, variances and covariances that are easy to interpret and calibrate.
:::

---

### The risk-free rate puzzle (Weil, 1989)

- Matching the equity premium with CRRA often requires high $\gamma$, but then the model predicts too high $\log R_f$ via $-\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2$.
- Conversely, matching the low observed $R_f$ calls for low $\gamma$ (or implausibly high $\beta$), then the equity premium becomes too small.
- This tension motivates enriched preferences or endowment risk, e.g., habit formation or disaster risk.

---

## Simple Growth-Based Habit (one-period)

We adopt a tractable specification where utility depends on current consumption and recent growth:
$$
u_t \;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma}\,\Big(\frac{C_{t-1}}{C_t}\Big)^{\kappa}
\;=\; \frac{1}{1-\gamma}\, C_t^{\,1-\gamma-\kappa}\,C_{t-1}^{\,\kappa},\qquad \gamma>0,\;\kappa\ge 0.
$$
This penalizes low consumption relative to last period (a simple habit flavor) yet keeps closed-form expressions.

---

### SDF and pricing equation

Marginal utility: $\;u_C(C_t) = C_t^{-\gamma-\kappa}\,C_{t-1}^{\kappa}$. The one-period SDF is
$$
\boxed{\; M = \beta\,\frac{u_C(C_1)}{u_C(C_0)}
\;=\; \beta\,\Big(\frac{C_1}{C_0}\Big)^{-(\gamma+\kappa)} \times \underbrace{\Big(\frac{C_0}{C_{-1}}\Big)^{\kappa}}_{\text{known at }t=0}\;,\quad 1=\mathbb E[MR].\;}
$$
The known term can be absorbed in normalization, so the random part is
$$
\log M = \log\beta - (\gamma+\kappa)\,\Delta c,\qquad \Delta c \equiv \log C_1 - \log C_0.
$$

---

### Log-linearization and the risk-free rate

If $\Delta c \sim \mathcal N(\mu_c,\sigma_c^2)$ (or is approximately normal):
$$
\boxed{\;\log R_f \approx -\log\beta + (\gamma+\kappa)\,\mu_c - \tfrac12(\gamma+\kappa)^2\,\sigma_c^2\; }.
$$
Risk premia (levels or logs) follow the usual covariance rules with $\log M$; habit simply shifts the effective sensitivity from $\gamma$ to $\gamma+\kappa$.

---

### Why this helps

- With $\kappa>0$, the SDF is more cyclical (responds more to $\Delta c$): larger premia for a given $\gamma$.
- The extra parameter $\kappa$ lets us jointly fit a low $R_f$ and sizable premia without resorting to extreme $\gamma$.
- Still keeps the same clean log-linear formulas.

---

## Rare Disasters: A Simple Model

We add low-probability, high-severity consumption drops to study their impact on policy and prices.

### Setup

- CRRA agent with SDF $M = \beta (C_1/C_0)^{-\gamma}$.
- Consumption growth with rare disasters (Barro-style):
  $$
  \Delta c = \mu_c + \sigma_c\,\varepsilon - J D,\quad \varepsilon\sim\mathcal N(0,1),\; D\sim\text{Bernoulli}(p),\; J>0,\; p\ll 1.
  $$
  With probability $p$, a disaster reduces consumption by a fraction $1-e^{-J}$.

---

### Risk-free rate with disaster risk

Using $R_f = 1/\mathbb E[M]$ and independence of $\varepsilon$ and $D$:
$$
\mathbb E[M] = \beta\,\mathbb E\big[e^{-\gamma\Delta c}\big] = \beta\,e^{-\gamma\mu_c + \tfrac12\gamma^2\sigma_c^2}\,\underbrace{\big[(1-p) + p\,e^{\gamma J}\big]}_{>1},
$$
so
$$
\boxed{\;\log R_f = -\log\beta + \gamma\mu_c - \tfrac12\gamma^2\sigma_c^2 \; -\; \log\big[(1-p) + p\,e^{\gamma J}\big].\;}
$$
The last (negative) term lowers $R_f$, helping resolve the risk‑free rate puzzle.

---

### Portfolio choice and expected returns

For any asset return $R$, $\;1=\mathbb E[M R]$ and the risk premium obeys
$$
\mathbb E[R]-R_f = -\frac{\operatorname{Cov}(M,R)}{\mathbb E[M]}.
$$
Disasters make $M$ spike when $R$ tends to be low (bad times), making $\operatorname{Cov}(M,R)$ more negative and thus raising required premia.

---

#### A toy linear exposure

Suppose $\log R = a + k\,\Delta c + \eta$, with $\eta$ i.i.d. and independent of $\Delta c$. Then (using the log-normal/jump approximation)
$$
\mathbb E[\log R] \approx a + k\mu_c - k\,p\,J + \tfrac12 k^2\sigma_c^2,
\quad
\operatorname{Cov}(\log M,\log R) \approx -\gamma k\,\sigma_c^2 + k\,\gamma\,p\,J.
$$
Higher $p$ or $J$ increases disaster-state covariance in magnitude, raising risk premia and lowering optimal risky demand in standard mean–variance intuition.

---

::: {.financial-concept}
Takeaway: rare disasters simultaneously reduce $R_f$ and increase equity premia, improving joint fit without extreme $\gamma$.
:::
